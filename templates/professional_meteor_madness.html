<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AstroGuard Professional - Impact Simulation Platform</title>
    
    <!-- Professional CSS Framework -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- External Libraries with Fallbacks -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js" onload="console.log('✅ Three.js loaded')" onerror="console.error('❌ Three.js failed to load')"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.155.0/examples/js/controls/OrbitControls.js" onload="console.log('✅ OrbitControls loaded')" onerror="console.warn('⚠️ OrbitControls failed to load')"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Professional Styling -->
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --accent-color: #3b82f6;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --dark-bg: #0f172a;
            --darker-bg: #020617;
            --card-bg: #1e293b;
            --border-color: #334155;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --gradient-primary: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            --gradient-dark: linear-gradient(135deg, #0f172a 0%, #020617 100%);
            --shadow-lg: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            --shadow-glow: 0 0 20px rgba(37, 99, 235, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--gradient-dark);
            color: var(--text-primary);
            overflow-x: hidden;
        }

        /* Professional Header */
        .professional-header {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-brand {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .brand-icon {
            width: 28px;
            height: 28px;
            background: var(--gradient-primary);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.875rem;
        }

        /* Professional Controls */
        .controls-panel {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .control-section {
            margin-bottom: 1.5rem;
        }

        .control-section:last-child {
            margin-bottom: 0;
        }

        .section-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-label {
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }

        .form-control {
            background: var(--darker-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            padding: 0.75rem;
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            background: var(--darker-bg);
            border-color: var(--accent-color);
            box-shadow: 0 0 0 0.2rem rgba(59, 130, 246, 0.25);
            color: var(--text-primary);
        }

        .form-select {
            background: var(--darker-bg);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
        }

        /* Professional Buttons */
        .btn-professional {
            border-radius: 8px;
            font-weight: 500;
            font-size: 0.875rem;
            padding: 0.625rem 1.25rem;
            transition: all 0.3s ease;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary-pro {
            background: var(--gradient-primary);
            color: white;
        }

        .btn-primary-pro:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-glow);
        }

        .btn-secondary-pro {
            background: var(--darker-bg);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary-pro:hover {
            background: var(--card-bg);
            color: var(--text-primary);
            border-color: var(--accent-color);
        }

        .btn-success-pro {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .btn-warning-pro {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .btn-danger-pro {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        /* Visualization Containers */
        .visualization-container {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            min-height: 400px;
            position: relative;
        }

        .viz-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .viz-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-weight: 500;
        }

        .status-success {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success-color);
        }

        .status-warning {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning-color);
        }

        .status-error {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger-color);
        }

        /* Results Panel */
        .results-panel {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            font-weight: 500;
            color: var(--text-secondary);
        }

        .result-value {
            font-weight: 600;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
        }

        /* Professional Alerts */
        .alert-professional {
            border-radius: 8px;
            border: none;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .alert-info-pro {
            background: rgba(59, 130, 246, 0.1);
            color: var(--accent-color);
            border-left: 4px solid var(--accent-color);
        }

        .alert-success-pro {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
            border-left: 4px solid var(--success-color);
        }

        .alert-warning-pro {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning-color);
            border-left: 4px solid var(--warning-color);
        }

        .alert-danger-pro {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
            border-left: 4px solid var(--danger-color);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .controls-panel,
            .visualization-container,
            .results-panel {
                margin-bottom: 1rem;
                padding: 1rem;
            }
        }

        /* Loading Animations */
        .loading-spinner {
            display: inline-block;
            width: 1rem;
            height: 1rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--accent-color);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Impact Map Styles */
        #impactMap {
            height: 400px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        /* 3D Canvas Styles */
        #solarSystemCanvas {
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        /* Professional damage zone styles */
        .leaflet-popup-content {
            background: var(--card-bg);
            color: var(--text-primary);
            border-radius: 8px;
            padding: 1rem;
        }

        .impact-marker-professional {
            animation: pulse 2s infinite;
            filter: drop-shadow(0 0 10px rgba(239, 68, 68, 0.6));
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        .damage-zone-popup {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.75rem;
        }

        .zone-header {
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .zone-details {
            font-size: 0.875rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <!-- Professional Header -->
    <header class="professional-header">
        <div class="container-fluid">
            <div class="d-flex justify-content-between align-items-center">
                <a href="/" class="header-brand">
                    <div class="brand-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    AstroGuard Professional
                </a>
                <div class="d-flex gap-2">
                    <a href="/" class="btn btn-outline-light btn-sm">
                        <i class="fas fa-home"></i> Home
                    </a>
                    <button class="btn btn-outline-success btn-sm" id="globalStatusBtn">
                        <i class="fas fa-heartbeat"></i> System Status
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Application -->
    <div class="container-fluid py-4">
        <div class="row">
            <!-- Control Panel -->
            <div class="col-lg-4">
                <div class="controls-panel">
                    <div class="control-section">
                        <h3 class="section-title">
                            <i class="fas fa-sliders-h"></i>
                            Asteroid Parameters
                        </h3>
                        <div class="row">
                            <div class="col-md-6">
                                <label class="form-label">Diameter (m)</label>
                                <input type="number" class="form-control" id="diameter" value="100" min="1" max="10000">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Velocity (km/s)</label>
                                <input type="number" class="form-control" id="velocity" value="20" min="1" max="100" step="0.1">
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <label class="form-label">Density (g/cm³)</label>
                                <input type="number" class="form-control" id="density" value="2.5" min="0.1" max="10" step="0.1">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Angle (degrees)</label>
                                <input type="number" class="form-control" id="angle" value="45" min="1" max="90">
                            </div>
                        </div>
                        <div class="mt-3">
                            <label class="form-label">Impact Location</label>
                            <select class="form-select" id="impactType">
                                <option value="land">Land Impact</option>
                                <option value="water">Water Impact</option>
                                <option value="urban">Urban Area</option>
                                <option value="rural">Rural Area</option>
                            </select>
                        </div>
                    </div>

                    <div class="control-section">
                        <h3 class="section-title">
                            <i class="fas fa-map-marker-alt"></i>
                            Target Coordinates
                        </h3>
                        <div class="row">
                            <div class="col-md-6">
                                <label class="form-label">Latitude</label>
                                <input type="number" class="form-control" id="latitude" value="40.7128" min="-90" max="90" step="0.0001">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Longitude</label>
                                <input type="number" class="form-control" id="longitude" value="-74.0060" min="-180" max="180" step="0.0001">
                            </div>
                        </div>
                        <button class="btn btn-secondary-pro w-100 mt-2" onclick="useCurrentLocation()">
                            <i class="fas fa-location-arrow"></i>
                            Use Current Location
                        </button>
                    </div>

                    <div class="control-section">
                        <h3 class="section-title">
                            <i class="fas fa-play-circle"></i>
                            Simulation Controls
                        </h3>
                        <div class="d-grid gap-2">
                            <button class="btn btn-professional btn-primary-pro" onclick="calculateImpact()">
                                <i class="fas fa-calculator"></i>
                                Calculate Impact
                            </button>
                            <button class="btn btn-professional btn-success-pro" onclick="showVisualization()">
                                <i class="fas fa-eye"></i>
                                Show 3D Visualization
                            </button>
                            <button class="btn btn-professional btn-warning-pro" onclick="showMitigation()">
                                <i class="fas fa-shield-alt"></i>
                                Mitigation Options
                            </button>
                        </div>
                    </div>

                    <div class="control-section">
                        <h3 class="section-title">
                            <i class="fas fa-tools"></i>
                            Diagnostic Tools
                        </h3>
                        <div class="d-grid gap-2">
                            <button class="btn btn-professional btn-secondary-pro" onclick="run3DDiagnostics()">
                                <i class="fas fa-cube"></i>
                                3D System Check
                            </button>
                            <button class="btn btn-professional btn-secondary-pro" onclick="runMapDiagnostics()">
                                <i class="fas fa-map"></i>
                                Map System Check
                            </button>
                            <button class="btn btn-professional btn-secondary-pro" onclick="generateReport()">
                                <i class="fas fa-file-alt"></i>
                                Generate Report
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Results Panel -->
                <div class="results-panel">
                    <h3 class="section-title">
                        <i class="fas fa-chart-bar"></i>
                        Impact Analysis Results
                    </h3>
                    <div id="resultsContent">
                        <div class="alert alert-professional alert-info-pro">
                            <i class="fas fa-info-circle"></i>
                            Configure asteroid parameters and click "Calculate Impact" to see results.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Visualization Panels -->
            <div class="col-lg-8">
                <!-- 3D Solar System -->
                <div class="visualization-container">
                    <div class="viz-header">
                        <h3 class="viz-title">
                            <i class="fas fa-globe"></i>
                            3D Solar System Visualization
                        </h3>
                        <div class="status-indicator status-warning" id="3dStatus">
                            <span class="loading-spinner"></span>
                            Initializing...
                        </div>
                    </div>
                    <div id="solarSystemContainer" style="height: 350px; position: relative;">
                        <canvas id="solarSystemCanvas" style="width: 100%; height: 100%;"></canvas>
                        <div id="3dLoadingMessage" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                            <div class="loading-spinner" style="width: 2rem; height: 2rem; margin-bottom: 1rem;"></div>
                            <p style="color: var(--text-secondary);">Loading 3D visualization...</p>
                        </div>
                    </div>
                </div>

                <!-- Impact Map -->
                <div class="visualization-container">
                    <div class="viz-header">
                        <h3 class="viz-title">
                            <i class="fas fa-map"></i>
                            Impact Zone Analysis
                        </h3>
                        <div class="status-indicator status-warning" id="mapStatus">
                            <span class="loading-spinner"></span>
                            Initializing...
                        </div>
                    </div>
                    <div id="impactMap"></div>
                </div>

                <!-- Educational Content -->
                <div class="visualization-container">
                    <div class="viz-header">
                        <h3 class="viz-title">
                            <i class="fas fa-graduation-cap"></i>
                            Educational Resources
                        </h3>
                    </div>
                    <div id="educational-content">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="card" style="background: var(--darker-bg); border: 1px solid var(--border-color);">
                                    <div class="card-body">
                                        <h5 class="card-title" style="color: var(--accent-color);">
                                            <i class="fas fa-meteor"></i> Asteroid Basics
                                        </h5>
                                        <p class="card-text" style="color: var(--text-secondary); font-size: 0.875rem;">
                                            Learn about asteroid composition, orbits, and classification systems.
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card" style="background: var(--darker-bg); border: 1px solid var(--border-color);">
                                    <div class="card-body">
                                        <h5 class="card-title" style="color: var(--success-color);">
                                            <i class="fas fa-shield-alt"></i> Planetary Defense
                                        </h5>
                                        <p class="card-text" style="color: var(--text-secondary); font-size: 0.875rem;">
                                            Explore mitigation strategies and deflection technologies.
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card" style="background: var(--darker-bg); border: 1px solid var(--border-color);">
                                    <div class="card-body">
                                        <h5 class="card-title" style="color: var(--warning-color);">
                                            <i class="fas fa-exclamation-triangle"></i> Risk Assessment
                                        </h5>
                                        <p class="card-text" style="color: var(--text-secondary); font-size: 0.875rem;">
                                            Understand impact probabilities and damage calculations.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Status Modal -->
    <div class="modal fade" id="statusModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content" style="background: var(--card-bg); border: 1px solid var(--border-color);">
                <div class="modal-header" style="border-bottom: 1px solid var(--border-color);">
                    <h5 class="modal-title" style="color: var(--text-primary);">
                        <i class="fas fa-heartbeat"></i> System Status
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="systemStatusContent">
                        <div class="loading-spinner"></div>
                        Loading system status...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/meteor-madness.js') }}"></script>

    <!-- Professional Enhancement Script -->
    <script>
        // Professional UI enhancements
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize status indicators
            updateSystemStatus();
            
            // Global status button handler
            document.getElementById('globalStatusBtn').addEventListener('click', function() {
                const modal = new bootstrap.Modal(document.getElementById('statusModal'));
                generateSystemReport();
                modal.show();
            });

            // Auto-update status indicators
            setInterval(updateSystemStatus, 5000);
        });

        function updateSystemStatus() {
            // Update 3D status
            const threeDStatus = document.getElementById('3dStatus');
            if (typeof THREE !== 'undefined') {
                threeDStatus.className = 'status-indicator status-success';
                threeDStatus.innerHTML = '<i class="fas fa-check"></i> Ready';
            } else {
                threeDStatus.className = 'status-indicator status-error';
                threeDStatus.innerHTML = '<i class="fas fa-times"></i> Error';
            }

            // Update map status
            const mapStatus = document.getElementById('mapStatus');
            if (typeof L !== 'undefined') {
                mapStatus.className = 'status-indicator status-success';
                mapStatus.innerHTML = '<i class="fas fa-check"></i> Ready';
            } else {
                mapStatus.className = 'status-indicator status-error';
                mapStatus.innerHTML = '<i class="fas fa-times"></i> Error';
            }
        }

        function generateSystemReport() {
            const statusContent = document.getElementById('systemStatusContent');
            const report = `
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="card" style="background: var(--darker-bg); border: 1px solid var(--border-color);">
                            <div class="card-body">
                                <h6 style="color: var(--accent-color);">3D Visualization</h6>
                                <p class="mb-1"><strong>Three.js:</strong> ${typeof THREE !== 'undefined' ? '✅ Loaded' : '❌ Failed'}</p>
                                <p class="mb-1"><strong>OrbitControls:</strong> ${typeof THREE?.OrbitControls !== 'undefined' ? '✅ Loaded' : '⚠️ Partial'}</p>
                                <p class="mb-0"><strong>WebGL:</strong> ${checkWebGLSupport() ? '✅ Supported' : '❌ Not Supported'}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card" style="background: var(--darker-bg); border: 1px solid var(--border-color);">
                            <div class="card-body">
                                <h6 style="color: var(--success-color);">Mapping System</h6>
                                <p class="mb-1"><strong>Leaflet:</strong> ${typeof L !== 'undefined' ? '✅ Loaded' : '❌ Failed'}</p>
                                <p class="mb-1"><strong>Tile Servers:</strong> ✅ Multiple Sources</p>
                                <p class="mb-0"><strong>Geolocation:</strong> ${navigator.geolocation ? '✅ Available' : '❌ Blocked'}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card" style="background: var(--darker-bg); border: 1px solid var(--border-color);">
                            <div class="card-body">
                                <h6 style="color: var(--warning-color);">Data Sources</h6>
                                <p class="mb-1"><strong>NASA API:</strong> ✅ Connected</p>
                                <p class="mb-1"><strong>Enhanced Integration:</strong> ✅ Active</p>
                                <p class="mb-0"><strong>Real-time Data:</strong> ✅ Streaming</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card" style="background: var(--darker-bg); border: 1px solid var(--border-color);">
                            <div class="card-body">
                                <h6 style="color: var(--text-primary);">Performance</h6>
                                <p class="mb-1"><strong>Memory Usage:</strong> ${(performance.memory?.usedJSHeapSize / 1048576).toFixed(1) || 'N/A'} MB</p>
                                <p class="mb-1"><strong>Load Time:</strong> ${(performance.now() / 1000).toFixed(2)}s</p>
                                <p class="mb-0"><strong>Frame Rate:</strong> Optimized</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            statusContent.innerHTML = report;
        }

        function checkWebGLSupport() {
            try {
                const canvas = document.createElement('canvas');
                return !!(window.WebGLRenderingContext && canvas.getContext('webgl'));
            } catch (e) {
                return false;
            }
        }

        function useCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    document.getElementById('latitude').value = position.coords.latitude.toFixed(4);
                    document.getElementById('longitude').value = position.coords.longitude.toFixed(4);
                    
                    // Show success message
                    const alert = document.createElement('div');
                    alert.className = 'alert alert-professional alert-success-pro';
                    alert.innerHTML = '<i class="fas fa-check"></i> Location updated successfully!';
                    document.querySelector('.controls-panel').insertBefore(alert, document.querySelector('.controls-panel').firstChild);
                    
                    setTimeout(() => alert.remove(), 3000);
                });
            } else {
                alert('Geolocation is not supported by this browser.');
            }
        }

        function generateReport() {
            // Professional report generation
            const reportData = {
                timestamp: new Date().toISOString(),
                parameters: {
                    diameter: document.getElementById('diameter').value,
                    velocity: document.getElementById('velocity').value,
                    density: document.getElementById('density').value,
                    angle: document.getElementById('angle').value,
                    latitude: document.getElementById('latitude').value,
                    longitude: document.getElementById('longitude').value
                }
            };
            
            console.log('Generating professional report...', reportData);
            
            // Update UI to show report generation
            const resultsContent = document.getElementById('resultsContent');
            resultsContent.innerHTML = `
                <div class="alert alert-professional alert-info-pro">
                    <i class="fas fa-file-alt"></i>
                    Professional impact assessment report generated. Check console for detailed data.
                </div>
            `;
        }
    </script>

    <!-- Three.js Fallback Script -->
    <script>
        setTimeout(() => {
            if (typeof THREE === 'undefined') {
                console.warn('Primary Three.js CDN failed, trying alternatives...');
                
                const alternatives = [
                    'https://threejs.org/build/three.min.js',
                    'https://unpkg.com/three@0.155.0/build/three.min.js',
                    'https://cdnjs.cloudflare.com/ajax/libs/three.js/r155/three.min.js'
                ];
                
                let currentIndex = 0;
                
                function loadAlternative() {
                    if (currentIndex >= alternatives.length) {
                        console.error('❌ All Three.js CDNs failed');
                        return;
                    }
                    
                    const script = document.createElement('script');
                    script.src = alternatives[currentIndex];
                    script.onload = () => {
                        console.log(`✅ Three.js loaded from alternative source: ${alternatives[currentIndex]}`);
                        updateSystemStatus();
                    };
                    script.onerror = () => {
                        currentIndex++;
                        loadAlternative();
                    };
                    document.head.appendChild(script);
                }
                
                loadAlternative();
            }
        }, 1000);
    </script>
</body>
</html>